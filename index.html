<!DOCTYPE html>
<html lang="id">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Tebak Angka Premium dengan Asisten Cici</title>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@300;400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/animate.css/4.1.1/animate.min.css">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0-beta3/css/all.min.css">
    <style>
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Poppins', sans-serif;
            -webkit-tap-highlight-color: transparent;
        }

        body {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            padding: 20px;
            touch-action: manipulation;
            overflow-x: hidden;
            line-height: 1.6;
            display: flex;
            flex-direction: column;
            align-items: center;
        }

        /* Navigation */
        .nav-container {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            background: rgba(255, 255, 255, 0.95);
            box-shadow: 0 2px 10px rgba(0,0,0,0.1);
            z-index: 1000;
            display: flex;
            justify-content: space-between;
            padding: 10px 20px;
            align-items: center;
        }

        .nav-brand {
            font-weight: 600;
            color: #2c3e50;
            display: flex;
            align-items: center;
            gap: 8px;
            font-size: 1.1rem;
        }

        .nav-menu {
            display: flex;
            gap: 10px;
        }

        .nav-btn {
            background: none;
            border: none;
            font-size: 1.1rem;
            color: #5d6d7e;
            cursor: pointer;
            transition: all 0.3s;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .nav-btn:hover {
            background-color: #f1f1f1;
            color: #3498db;
        }

        .nav-btn.active {
            color: #3498db;
            background-color: #e3f2fd;
        }

        /* Main Content */
        .main-content {
            width: 100%;
            max-width: 800px;
            margin-top: 70px;
            display: none;
            animation: fadeIn 0.5s ease;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }

        .main-content.active {
            display: block;
        }

        /* Game Container */
        .game-container {
            background-color: rgba(255, 255, 255, 0.97);
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0, 0, 0, 0.15);
            width: 100%;
            padding: 25px;
            text-align: center;
            position: relative;
            overflow: hidden;
            margin-bottom: 20px;
            backdrop-filter: blur(5px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }

        .game-header {
            margin-bottom: 20px;
            position: relative;
        }

        .game-header h1 {
            color: #2c3e50;
            margin-bottom: 10px;
            font-size: 1.8rem;
            font-weight: 600;
            background: linear-gradient(90deg, #3498db, #9b59b6);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            text-shadow: 0 2px 4px rgba(0,0,0,0.1);
        }

        .game-header .description {
            color: #5d6d7e;
            margin-bottom: 15px;
            font-size: 0.95rem;
            line-height: 1.6;
            padding: 0 10px;
        }

        .input-area {
            margin: 20px 0;
            position: relative;
        }

        #guess-input {
            width: 100%;
            max-width: 220px;
            padding: 14px 16px;
            font-size: 1.1rem;
            border: 2px solid rgba(52, 152, 219, 0.4);
            border-radius: 12px;
            text-align: center;
            margin-bottom: 15px;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            background-color: rgba(255, 255, 255, 0.95);
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            font-weight: 500;
            color: #2c3e50;
        }

        #guess-input:focus {
            outline: none;
            border-color: #2980b9;
            box-shadow: 0 0 0 4px rgba(52, 152, 219, 0.25);
            transform: translateY(-2px);
        }

        .button-group {
            display: flex;
            flex-wrap: wrap;
            justify-content: center;
            gap: 10px;
            margin-bottom: 20px;
        }

        .game-btn {
            flex: 1;
            min-width: 120px;
            padding: 12px;
            border: none;
            border-radius: 10px;
            font-size: 0.95rem;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            color: white;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            position: relative;
            overflow: hidden;
        }

        .game-btn::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: linear-gradient(rgba(255,255,255,0.2), transparent);
            opacity: 0;
            transition: opacity 0.3s;
        }

        .game-btn:hover::after {
            opacity: 1;
        }

        .game-btn:active {
            transform: scale(0.96) translateY(2px);
            box-shadow: 0 3px 8px rgba(0,0,0,0.1);
        }

        #guess-btn {
            background: linear-gradient(135deg, #2ecc71 0%, #27ae60 100%);
        }

        #guess-btn:hover {
            background: linear-gradient(135deg, #27ae60 0%, #2ecc71 100%);
        }

        #hint-btn {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
        }

        #hint-btn:hover {
            background: linear-gradient(135deg, #2980b9 0%, #3498db 100%);
        }

        #new-game-btn {
            background: linear-gradient(135deg, #e74c3c 0%, #c0392b 100%);
        }

        #new-game-btn:hover {
            background: linear-gradient(135deg, #c0392b 0%, #e74c3c 100%);
        }

        .message-area {
            background-color: #f8f9fa;
            border-radius: 14px;
            padding: 18px;
            min-height: 120px;
            margin-bottom: 20px;
            text-align: left;
            position: relative;
            border-left: 4px solid #3498db;
            max-height: 250px;
            overflow-y: auto;
            box-shadow: inset 0 2px 6px rgba(0,0,0,0.05);
            transition: all 0.3s;
        }

        .message-area::before {
            content: "Cici:";
            position: absolute;
            top: -12px;
            left: 15px;
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 4px 15px;
            border-radius: 16px;
            font-size: 0.8rem;
            font-weight: bold;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
            z-index: 1;
        }

        .message-area p {
            margin-bottom: 8px;
            line-height: 1.6;
            color: #34495e;
            font-size: 0.9rem;
        }

        .typing-indicator {
            display: flex;
            gap: 5px;
            justify-content: flex-start;
            margin-top: 10px;
            padding-left: 5px;
        }

        .typing-indicator span {
            width: 7px;
            height: 7px;
            background-color: #3498db;
            border-radius: 50%;
            opacity: 0.4;
            animation: typingAnimation 1s infinite;
        }

        .typing-indicator span:nth-child(2) {
            animation-delay: 0.2s;
        }

        .typing-indicator span:nth-child(3) {
            animation-delay: 0.4s;
        }

        @keyframes typingAnimation {
            0%, 100% { transform: translateY(0); opacity: 0.4; }
            50% { transform: translateY(-4px); opacity: 1; }
        }

        /* Stats Section */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 12px;
            margin-top: 15px;
        }

        .stat-box {
            background: rgba(255, 255, 255, 0.9);
            border-radius: 12px;
            padding: 15px;
            text-align: center;
            box-shadow: 0 4px 10px rgba(0,0,0,0.08);
            transition: all 0.3s;
        }

        .stat-box:hover {
            transform: translateY(-3px);
            box-shadow: 0 6px 15px rgba(0,0,0,0.1);
        }

        .stat-label {
            font-size: 0.85rem;
            color: #7f8c8d;
            margin-bottom: 5px;
        }

        .stat-value {
            font-size: 1.5rem;
            font-weight: 700;
            color: #3498db;
        }

        /* Assistant Panel */
        .assistant-panel {
            position: fixed;
            bottom: 80px;
            right: 20px;
            width: 300px;
            max-height: 400px;
            background-color: white;
            border-radius: 16px;
            box-shadow: 0 10px 25px rgba(0,0,0,0.2);
            z-index: 1000;
            display: flex;
            flex-direction: column;
            transform: translateX(120%) translateY(20px);
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            opacity: 0;
            border: 1px solid rgba(255,255,255,0.2);
            overflow: hidden;
        }

        .assistant-panel.open {
            transform: translateX(0) translateY(0);
            opacity: 1;
        }

        .assistant-header {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            padding: 12px;
            border-top-left-radius: 16px;
            border-top-right-radius: 16px;
            display: flex;
            justify-content: space-between;
            align-items: center;
            box-shadow: 0 2px 8px rgba(0,0,0,0.1);
        }

        .assistant-header h3 {
            font-size: 1rem;
            margin: 0;
            font-weight: 600;
        }

        .assistant-close {
            background: none;
            border: none;
            color: white;
            font-size: 1.3rem;
            cursor: pointer;
            transition: transform 0.2s;
            width: 28px;
            height: 28px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
        }

        .assistant-close:hover {
            transform: rotate(90deg);
            background-color: rgba(255,255,255,0.2);
        }

        .assistant-messages {
            flex: 1;
            padding: 14px;
            overflow-y: auto;
            max-height: 300px;
            background-color: #f9f9f9;
        }

        .assistant-message {
            margin-bottom: 10px;
            padding: 8px 12px;
            border-radius: 10px;
            max-width: 85%;
            font-size: 0.9rem;
            line-height: 1.5;
            position: relative;
            animation: fadeIn 0.3s ease;
            box-shadow: 0 2px 5px rgba(0,0,0,0.05);
        }

        .user-message {
            background-color: #e3f2fd;
            margin-left: auto;
            border-top-right-radius: 0;
            color: #0d47a1;
        }

        .bot-message {
            background-color: #f1f1f1;
            margin-right: auto;
            border-top-left-radius: 0;
            color: #333;
        }

        .assistant-input-area {
            display: flex;
            padding: 10px;
            border-top: 1px solid #eee;
            background-color: white;
        }

        #assistant-input {
            flex: 1;
            padding: 8px 12px;
            border: 1px solid #ddd;
            border-radius: 20px;
            margin-right: 8px;
            font-size: 0.9rem;
            transition: all 0.3s;
        }

        #assistant-input:focus {
            outline: none;
            border-color: #3498db;
            box-shadow: 0 0 0 3px rgba(52, 152, 219, 0.2);
        }

        #assistant-send {
            background: linear-gradient(135deg, #3498db 0%, #2980b9 100%);
            color: white;
            border: none;
            border-radius: 50%;
            width: 36px;
            height: 36px;
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: all 0.3s;
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }

        #assistant-send:hover {
            transform: scale(1.05);
            box-shadow: 0 3px 8px rgba(0,0,0,0.15);
        }

        #assistant-send:active {
            transform: scale(0.95);
        }

        /* AI Character */
        .ai-character {
            position: fixed;
            bottom: 20px;
            right: 20px;
            width: 70px;
            height: 70px;
            z-index: 1000;
            cursor: pointer;
            transition: all 0.4s cubic-bezier(0.25, 0.8, 0.25, 1);
            filter: drop-shadow(0 5px 10px rgba(0,0,0,0.2));
            overflow-x: hidden;
            overflow-y: hidden;
        }

        .ai-character:hover {
            transform: scale(1.1) translateY(-5px);
            filter: drop-shadow(0 8px 15px rgba(0,0,0,0.25));
        }

        .ai-character:active {
            transform: scale(0.95);
        }

        .ai-character svg {
            width: 100%;
            height: 100%;
        }

        .speech-bubble {
            position: absolute;
            bottom: 80px;
            right: 0;
            background-color: white;
            padding: 8px 14px;
            border-radius: 16px;
            box-shadow: 0 5px 20px rgba(0,0,0,0.15);
            max-width: 200px;
            font-size: 0.8rem;
            transform: scale(0);
            transform-origin: bottom right;
            transition: all 0.3s cubic-bezier(0.25, 0.8, 0.25, 1);
            opacity: 0;
            line-height: 1.4;
        }

        .speech-bubble.show {
            transform: scale(1);
            opacity: 1;
        }

        /* Settings Panel */
        .settings-panel {
            position: fixed;
            top: 50%;
            left: 50%;
            transform: translate(-50%, -50%);
            background-color: white;
            border-radius: 14px;
            box-shadow: 0 12px 30px rgba(0,0,0,0.25);
            padding: 20px;
            width: 90%;
            max-width: 380px;
            z-index: 1002;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .settings-panel.open {
            opacity: 1;
            pointer-events: auto;
        }
        
        .settings-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 15px;
        }
        
        .settings-header h2 {
            font-size: 1.3rem;
            color: #2c3e50;
            margin: 0;
        }
        
        .settings-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
            color: #7f8c8d;
        }
        
        .settings-content {
            margin-bottom: 15px;
        }
        
        .setting-item {
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 10px 0;
            border-bottom: 1px solid #eee;
        }
        
        .setting-item:last-child {
            border-bottom: none;
        }
        
        .setting-label {
            font-size: 0.95rem;
            color: #34495e;
        }
        
        .toggle-switch {
            position: relative;
            display: inline-block;
            width: 45px;
            height: 22px;
        }
        
        .toggle-switch input {
            opacity: 0;
            width: 0;
            height: 0;
        }
        
        .slider {
            position: absolute;
            cursor: pointer;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background-color: #ccc;
            transition: .4s;
            border-radius: 22px;
        }
        
        .slider:before {
            position: absolute;
            content: "";
            height: 16px;
            width: 16px;
            left: 3px;
            bottom: 3px;
            background-color: white;
            transition: .4s;
            border-radius: 50%;
        }
        
        input:checked + .slider {
            background-color: #3498db;
        }
        
        input:checked + .slider:before {
            transform: translateX(23px);
        }
        
        .name-input {
            width: 100%;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 6px;
            margin-top: 5px;
            font-size: 0.95rem;
        }
        
        .settings-footer {
            display: flex;
            justify-content: flex-end;
        }
        
        .settings-btn {
            padding: 8px 16px;
            border: none;
            border-radius: 6px;
            background-color: #3498db;
            color: white;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s;
        }
        
        .settings-btn:hover {
            background-color: #2980b9;
        }
        
        .overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.5);
            z-index: 1001;
            opacity: 0;
            pointer-events: none;
            transition: all 0.3s ease;
        }
        
        .overlay.open {
            opacity: 1;
            pointer-events: auto;
        }

        /* API Status */
        .api-status {
            position: fixed;
            top: 15px;
            left: 15px;
            padding: 6px 10px;
            border-radius: 16px;
            font-size: 0.75rem;
            font-weight: 500;
            display: flex;
            align-items: center;
            z-index: 1001;
            background-color: rgba(255,255,255,0.9);
            box-shadow: 0 2px 6px rgba(0,0,0,0.1);
        }
        
        .api-status-dot {
            width: 8px;
            height: 8px;
            border-radius: 50%;
            margin-right: 6px;
        }
        
        .api-status.connected .api-status-dot {
            background-color: #2ecc71;
        }
        
        .api-status.disconnected .api-status-dot {
            background-color: #e74c3c;
        }
        
        .api-status.connecting .api-status-dot {
            background-color: #f39c12;
            animation: pulse 1.5s infinite;
        }

        @keyframes pulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }

        /* Confetti */
        #confetti-container {
            position: fixed; 
            top: 0; 
            left: 0; 
            width: 100%; 
            height: 100%; 
            pointer-events: none; 
            z-index: 1002;
        }

        /* Loading Overlay */
        .loading-overlay {
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0,0,0,0.7);
            display: flex;
            justify-content: center;
            align-items: center;
            z-index: 2000;
            flex-direction: column;
        }
        
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 4px solid rgba(255,255,255,0.3);
            border-radius: 50%;
            border-top-color: #3498db;
            animation: spin 1s ease-in-out infinite;
        }
        
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
        
        .loading-text {
            color: white;
            margin-top: 12px;
            font-size: 1rem;
        }

        /* Responsive Styles */
        @media (max-width: 640px) {
            body {
                padding: 15px;
            }
            
            .game-container {
                padding: 20px;
            }

            .game-header h1 {
                font-size: 1.6rem;
            }

            .game-btn {
                min-width: 100px;
                font-size: 0.9rem;
                padding: 10px;
            }

            .assistant-panel {
                width: 90%;
                max-width: 280px;
                right: 5%;
                bottom: 70px;
            }

            .ai-character {
                width: 60px;
                height: 60px;
                right: 15px;
                bottom: 15px;
            }

            .speech-bubble {
                bottom: 70px;
                max-width: 180px;
                right: -10px;
            }
            
            .stats-container {
                grid-template-columns: 1fr;
            }
        }
        
        @media (max-width: 480px) {
            .game-container {
                padding: 18px;
            }
            
            .game-header h1 {
                font-size: 1.4rem;
            }
            
            .button-group {
                gap: 8px;
            }
            
            .game-btn {
                min-width: 90px;
                font-size: 0.85rem;
                padding: 8px;
            }
            
            #guess-input {
                padding: 12px;
                font-size: 1rem;
            }

            .nav-menu {
                gap: 8px;
            }

            .nav-btn {
                width: 32px;
                height: 32px;
                font-size: 0.9rem;
            }
        }
    </style>
</head>
<body>
    <!-- Navigation -->
    <div class="nav-container">
        <div class="nav-brand">
            <i class="fas fa-gamepad"></i>
            <span>Tebak Angka</span>
        </div>
        <div class="nav-menu">
            <button class="nav-btn active" id="game-btn" title="Game">
                <i class="fas fa-bullseye"></i>
            </button>
            <button class="nav-btn" id="stats-btn" title="Statistik">
                <i class="fas fa-chart-bar"></i>
            </button>
            <button class="nav-btn" id="about-btn" title="Tentang">
                <i class="fas fa-info-circle"></i>
            </button>
            <button class="nav-btn" id="settings-btn" title="Pengaturan">
                <i class="fas fa-cog"></i>
            </button>
        </div>
    </div>

    <!-- API Status -->
    <div class="api-status disconnected" id="api-status">
        <div class="api-status-dot"></div>
        <span>Mode Offline</span>
    </div>

    <!-- Loading Overlay -->
    <div class="loading-overlay" id="loading-overlay">
        <div class="loading-spinner"></div>
        <div class="loading-text">Memuat game...</div>
    </div>

    <!-- Audio Elements -->
    <audio id="bg-music" loop>
        <source src="https://www.soundhelix.com/examples/mp3/SoundHelix-Song-1.mp3" type="audio/mpeg">
    </audio>
    <audio id="win-sound">
        <source src="https://assets.mixkit.co/active_storage/sfx/2015/2015-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="lose-sound">
        <source src="https://assets.mixkit.co/active_storage/sfx/213/213-preview.mp3" type="audio/mpeg">
    </audio>
    <audio id="click-sound">
        <source src="https://assets.mixkit.co/active_storage/sfx/239/239-preview.mp3" type="audio/mpeg">
    </audio>

    <!-- Settings Panel -->
    <div class="settings-panel" id="settings-panel">
        <div class="settings-header">
            <h2>Pengaturan Game</h2>
            <button class="settings-close" id="settings-close">&times;</button>
        </div>
        <div class="settings-content">
            <div class="setting-item">
                <div class="setting-label">Nama Pemain</div>
                <input type="text" id="player-name-input" class="name-input" placeholder="Masukkan nama Anda">
            </div>
            <div class="setting-item">
                <div class="setting-label">Musik Latar</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="music-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">Efek Suara</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="sound-effects-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">Mode Sulit</div>
                <label class="toggle-switch">
                    <input type="checkbox" id="hard-mode-toggle">
                    <span class="slider"></span>
                </label>
            </div>
            <div class="setting-item">
                <div class="setting-label">Status AI</div>
                <div id="api-status-indicator" style="font-size:0.8rem; color:#2ecc71;">
                    ‚úî Terhubung
                </div>
            </div>
        </div>
        <div class="settings-footer">
            <button class="settings-btn" id="save-settings">Simpan</button>
        </div>
    </div>
    
    <div class="overlay" id="settings-overlay"></div>

    <!-- Main Content Sections -->
    <div class="main-content active" id="game-section">
        <div class="game-container">
            <div class="game-header">
                <h1>üéØ Tebak Angka Premium</h1>
                <p class="description">Asisten virtual Cici telah memilih angka rahasia antara 1-100. Bisakah kamu menebaknya dalam waktu singkat?</p>
            </div>
            
            <div class="input-area">
                <input type="number" id="guess-input" min="1" max="100" placeholder="Masukkan tebakan" inputmode="numeric">
            </div>
            
            <div class="button-group">
                <button class="game-btn" id="guess-btn">TEBAK</button>
                <button class="game-btn" id="hint-btn">PETUNJUK</button>
                <button class="game-btn" id="new-game-btn">GAME BARU</button>
            </div>
            
            <div class="message-area" id="message-area">
                <p>Hai! Aku Cici. Aku sudah memilih angka rahasia antara 1 sampai 100. Ayo tebak!</p>
                <div class="typing-indicator" id="typing-indicator" style="display: none;">
                    <span></span><span></span><span></span>
                </div>
            </div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-label">Percobaan</div>
                    <div class="stat-value" id="attempts">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Rekor</div>
                    <div class="stat-value" id="best-score">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Mode</div>
                    <div class="stat-value" id="difficulty-indicator">Normal</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Terakhir</div>
                    <div class="stat-value" id="last-guess">-</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content" id="stats-section">
        <div class="game-container">
            <div class="game-header">
                <h1>üìä Statistik Game</h1>
                <p class="description">Lihat perkembangan permainanmu dan capai rekor baru!</p>
            </div>
            
            <div class="stats-container">
                <div class="stat-box">
                    <div class="stat-label">Game Dimainkan</div>
                    <div class="stat-value" id="total-games">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Game Menang</div>
                    <div class="stat-value" id="games-won">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Rekor Tebakan</div>
                    <div class="stat-value" id="best-attempt">-</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Kemenangan Beruntun</div>
                    <div class="stat-value" id="current-streak">0</div>
                </div>
                <div class="stat-box">
                    <div class="stat-label">Tingkat Kemenangan</div>
                    <div class="stat-value" id="win-rate">0%</div>
                </div>
            </div>
        </div>
    </div>

    <div class="main-content" id="about-section">
        <div class="game-container">
            <div class="game-header">
                <h1>‚ÑπÔ∏è Tentang Game</h1>
                <p class="description">Selamat datang di game Tebak Angka Premium dengan asisten virtual Cici!</p>
            </div>
            
            <div class="message-area">
                <p>Game ini adalah permainan tebak angka klasik dengan sentuhan modern yang dilengkapi dengan:</p>
                
                <ul style="padding-left: 20px; margin: 10px 0;">
                    <li>Asisten virtual Cici yang ramah dan membantu</li>
                    <li>Mode normal (1-100) dan mode sulit (1-200)</li>
                    <li>Statistik permainan yang lengkap</li>
                    <li>Efek suara dan musik yang menyenangkan</li>
                    <li>Fitur petunjuk ketika kesulitan</li>
                    <li>Animasi dan visual yang menarik</li>
                    <li>Dukungan AI canggih melalui Gemini API</li>
                </ul>
                
                <p>Cara bermain:</p>
                <ol style="padding-left: 20px; margin: 10px 0;">
                    <li>Cici akan memilih angka rahasia secara acak</li>
                    <li>Tebak angka tersebut dengan memasukkan angka pada kolom tebakan</li>
                    <li>Cici akan memberi tahu apakah tebakanmu terlalu tinggi atau rendah</li>
                    <li>Gunakan petunjuk jika kamu kesulitan</li>
                    <li>Tebak dengan sesedikit mungkin percobaan!</li>
                </ol>
                
                <p>Selamat bermain dan semoga berhasil!</p>
            </div>
        </div>
    </div>

    <!-- Assistant Panel -->
    <div class="assistant-panel" id="assistant-panel">
        <div class="assistant-header">
            <h3>Konsultasi dengan Cici</h3>
            <button class="assistant-close" id="assistant-close">&times;</button>
        </div>
        <div class="assistant-messages" id="assistant-messages">
            <div class="assistant-message bot-message">
                Hai! Aku Cici, asisten virtualmu. Sekarang aku didukung oleh AI canggih dari Google Gemini. Ada yang bisa aku bantu tentang game tebak angka ini?
            </div>
        </div>
        <div class="assistant-input-area">
            <input type="text" id="assistant-input" placeholder="Tulis pertanyaanmu...">
            <button id="assistant-send">
                <i class="fas fa-paper-plane"></i>
            </button>
        </div>
    </div>

    <!-- AI Character -->
    <div class="ai-character" id="ai-character">
        <div class="speech-bubble" id="speech-bubble"></div>
        <svg viewBox="0 0 200 200" xmlns="http://www.w3.org/2000/svg">
            <defs>
                <linearGradient id="headGradient" x1="0%" y1="0%" x2="100%" y2="100%">
                    <stop offset="0%" stop-color="#FFB6C1" />
                    <stop offset="100%" stop-color="#FF69B4" />
                </linearGradient>
            </defs>
            <circle cx="100" cy="100" r="80" fill="url(#headGradient)"/>
            <circle cx="70" cy="80" r="15" fill="white" class="blink"/>
            <circle cx="130" cy="80" r="15" fill="white" class="blink"/>
            <circle cx="70" cy="80" r="7" fill="#333"/>
            <circle cx="130" cy="80" r="7" fill="#333"/>
            <circle cx="55" cy="100" r="12" fill="#FF69B4" opacity="0.3"/>
            <circle cx="145" cy="100" r="12" fill="#FF69B4" opacity="0.3"/>
            <path id="mouth" d="M70 130 Q100 150 130 130" fill="transparent" stroke="#333" stroke-width="3"/>
            <div class="mouth" id="mouth-animated"></div>
        </svg>
    </div>

    <!-- Confetti Container -->
    <div id="confetti-container"></div>

    <script>
        const gameState = {
            secretNumber: 0,
            attempts: 0,
            bestScore: null,
            bestScoreDate: null,
            bestScorePlayer: null,
            gameActive: true,
            aiSpeaking: false,
            playerName: "Player",
            musicEnabled: true,
            soundEffectsEnabled: true,
            hardMode: false,
            gamesPlayed: 0,
            gamesWon: 0,
            winStreak: 0,
            lastGuess: null
        };

        const LOCAL_API_RESPONSES = {
            greetings: [
                "Hai! Aku Cici. Ayo main tebak angka!",
                "Halo! Siap bermain tebak angka hari ini?",
                "Hai teman! Aku punya angka rahasia nih."
            ],
            win: [
                "Hebat! Kamu berhasil menebak dengan benar!",
                "Keren! Tebakanmu tepat sekali!",
                "Kamu memang jago dalam permainan ini!",
                "Selamat! Kamu berhasil menebak angkaku!",
                "Wow! Kamu sangat cepat menebaknya!"
            ],
            hint: [
                "Coba tebak angka antara {low} dan {high}",
                "Angkaku {evenOdd}",
                "Jumlah digit angkaku adalah {digitCount}",
                "Angkaku {greaterLess} dari {midPoint}",
                "Angkaku {divisible} dibagi {divisor}"
            ],
            tooLow: [
                "Terlalu rendah! Coba lebih tinggi",
                "Masih kurang besar tebakanmu",
                "Angkaku lebih besar dari itu",
                "Coba angka yang lebih tinggi",
                "Tebakanmu masih di bawah"
            ],
            tooHigh: [
                "Terlalu tinggi! Coba lebih rendah",
                "Masih kurang kecil tebakanmu",
                "Angkaku lebih kecil dari itu",
                "Coba angka yang lebih rendah",
                "Tebakanmu masih di atas"
            ],
            generalTips: [
                "Gunakan strategi binary search",
                "Perhatikan range angka yang mungkin",
                "Gunakan petunjuk jika kesulitan",
                "Coba bagi range menjadi dua bagian",
                "Perhatikan petunjuk yang diberikan"
            ],
            assistant: [
                "Aku bisa membantu memberikan petunjuk tentang angka rahasia",
                "Ingin tahu strategi terbaik untuk menebak angka?",
                "Gunakan tombol petunjuk jika kamu kesulitan",
                "Game ini lebih seru jika kamu menebak dengan sedikit percobaan",
                "Aku selalu memilih angka acak setiap game baru"
            ]
        };

        const elements = {
            gameBtn: document.getElementById('game-btn'),
            statsBtn: document.getElementById('stats-btn'),
            aboutBtn: document.getElementById('about-btn'),
            settingsBtn: document.getElementById('settings-btn'),
            gameSection: document.getElementById('game-section'),
            statsSection: document.getElementById('stats-section'),
            aboutSection: document.getElementById('about-section'),
            guessInput: document.getElementById('guess-input'),
            guessBtn: document.getElementById('guess-btn'),
            hintBtn: document.getElementById('hint-btn'),
            newGameBtn: document.getElementById('new-game-btn'),
            messageArea: document.getElementById('message-area'),
            typingIndicator: document.getElementById('typing-indicator'),
            attemptsDisplay: document.getElementById('attempts'),
            bestScoreDisplay: document.getElementById('best-score'),
            difficultyIndicator: document.getElementById('difficulty-indicator'),
            lastGuessDisplay: document.getElementById('last-guess'),
            totalGamesDisplay: document.getElementById('total-games'),
            gamesWonDisplay: document.getElementById('games-won'),
            bestAttemptDisplay: document.getElementById('best-attempt'),
            currentStreakDisplay: document.getElementById('current-streak'),
            winRateDisplay: document.getElementById('win-rate'),
            aiCharacter: document.getElementById('ai-character'),
            speechBubble: document.getElementById('speech-bubble'),
            mouthAnimated: document.getElementById('mouth-animated'),
            mouth: document.getElementById('mouth'),
            assistantPanel: document.getElementById('assistant-panel'),
            assistantClose: document.getElementById('assistant-close'),
            assistantMessages: document.getElementById('assistant-messages'),
            assistantInput: document.getElementById('assistant-input'),
            assistantSend: document.getElementById('assistant-send'),
            bgMusic: document.getElementById('bg-music'),
            winSound: document.getElementById('win-sound'),
            loseSound: document.getElementById('lose-sound'),
            clickSound: document.getElementById('click-sound'),
            settingsPanel: document.getElementById('settings-panel'),
            settingsClose: document.getElementById('settings-close'),
            settingsOverlay: document.getElementById('settings-overlay'),
            saveSettingsBtn: document.getElementById('save-settings'),
            playerNameInput: document.getElementById('player-name-input'),
            musicToggle: document.getElementById('music-toggle'),
            soundEffectsToggle: document.getElementById('sound-effects-toggle'),
            hardModeToggle: document.getElementById('hard-mode-toggle'),
            apiStatusIndicator: document.getElementById('api-status-indicator'),
            loadingOverlay: document.getElementById('loading-overlay'),
            apiStatus: document.getElementById('api-status'),
            confettiContainer: document.getElementById('confetti-container')
        };

        const synth = window.speechSynthesis;
        let voices = [];

        document.addEventListener('DOMContentLoaded', initGame);

        function initGame() {
            setupEventListeners();
            loadGameState();
            generateSecretNumber();
            
            const greeting = getRandomResponse('greetings');
            showMessage(greeting);
            speak(greeting);
            
            updateUIMode();
            updateStatsDisplay();
            
            setTimeout(() => {
                elements.loadingOverlay.style.display = 'none';
            }, 1000);
            
            if (synth.onvoiceschanged !== undefined) {
                synth.onvoiceschanged = loadVoices;
            }
            loadVoices();
        }

        function setupEventListeners() {
            elements.guessBtn.addEventListener('click', checkGuess);
            elements.hintBtn.addEventListener('click', giveHint);
            elements.newGameBtn.addEventListener('click', startNewGame);
            elements.guessInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') checkGuess();
            });
            
            elements.aiCharacter.addEventListener('click', function() {
                if (gameState.aiSpeaking) return;
                const randomMsg = getRandomResponse('assistant');
                speak(randomMsg);
            });

            elements.aiCharacter.addEventListener('dblclick', toggleAssistantPanel);
            elements.assistantClose.addEventListener('click', toggleAssistantPanel);
            elements.assistantSend.addEventListener('click', sendAssistantMessage);
            elements.assistantInput.addEventListener('keypress', function(e) {
                if (e.key === 'Enter') sendAssistantMessage();
            });

            elements.settingsBtn.addEventListener('click', toggleSettingsPanel);
            elements.settingsClose.addEventListener('click', toggleSettingsPanel);
            elements.settingsOverlay.addEventListener('click', toggleSettingsPanel);
            elements.saveSettingsBtn.addEventListener('click', saveSettings);

            elements.gameBtn.addEventListener('click', () => switchTab('game'));
            elements.statsBtn.addEventListener('click', () => switchTab('stats'));
            elements.aboutBtn.addEventListener('click', () => switchTab('about'));
            
            document.addEventListener('click', function() {
                if (gameState.musicEnabled && elements.bgMusic.paused) {
                    elements.bgMusic.play().catch(e => console.log("Audio play blocked:", e));
                }
            }, { once: true });
        }

        async function queryGemini(prompt) {
            try {
                elements.apiStatus.classList.remove('disconnected');
                elements.apiStatus.classList.add('connecting');
                elements.apiStatus.querySelector('span').textContent = 'Menghubungkan...';

                // Gunakan API key gratis Anda di sini
                const API_KEY = ''; // Ganti dengan API key gratis Anda
                const response = await fetch(`https://generativelanguage.googleapis.com/v1beta/models/:generateContent?key=${API_KEY}`, {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        contents: [{
                            parts: [{
                                text: `Kamu adalah Cici, asisten virtual yang membantu pemain dalam game tebak angka. Kamu ramah, sabar, dan memberikan petunjuk yang membantu tanpa memberikan jawaban langsung. Gunakan bahasa Indonesia yang santai dan friendly. ${prompt}`
                            }]
                        }]
                    })
                });

                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }

                const data = await response.json();
                
                elements.apiStatus.classList.remove('connecting');
                elements.apiStatus.classList.add('connected');
                elements.apiStatus.querySelector('span').textContent = 'Mode Online';
                
                return data.candidates[0].content.parts[0].text;
            } catch (error) {
                console.error("Error querying Gemini API:", error);
                elements.apiStatus.classList.remove('connecting');
                elements.apiStatus.classList.add('disconnected');
                elements.apiStatus.querySelector('span').textContent = 'Mode Offline';
                return getRandomResponse('assistant');
            }
        }

        function getRandomResponse(type) {
            const responses = LOCAL_API_RESPONSES[type];
            if (!responses) return "";
            
            if (type === 'hint') {
                const maxNumber = gameState.hardMode ? 200 : 100;
                const midPoint = Math.floor(maxNumber / 2);
                const low = Math.max(1, gameState.lastGuess ? gameState.lastGuess + 1 : 1);
                const high = Math.min(maxNumber, gameState.lastGuess ? gameState.lastGuess - 1 : maxNumber);
                
                const hintData = {
                    low: low,
                    high: high,
                    evenOdd: gameState.secretNumber % 2 === 0 ? 'genap' : 'ganjil',
                    digitCount: gameState.secretNumber.toString().length,
                    greaterLess: gameState.secretNumber > midPoint ? 'lebih besar' : 'lebih kecil',
                    midPoint: midPoint,
                    divisible: gameState.secretNumber % 3 === 0 ? 'habis' : 'tidak habis',
                    divisor: 3
                };
                
                const template = responses[Math.floor(Math.random() * responses.length)];
                return template.replace(/{(\w+)}/g, (match, key) => hintData[key] || match);
            }
            
            return responses[Math.floor(Math.random() * responses.length)];
        }

        function loadGameState() {
            if (localStorage.getItem('playerName')) {
                gameState.playerName = localStorage.getItem('playerName');
            }
            
            if (localStorage.getItem('bestScore')) {
                gameState.bestScore = parseInt(localStorage.getItem('bestScore'));
                gameState.bestScoreDate = localStorage.getItem('bestScoreDate');
                gameState.bestScorePlayer = localStorage.getItem('bestScorePlayer') || gameState.playerName;
                elements.bestScoreDisplay.textContent = gameState.bestScore;
            }
            
            if (localStorage.getItem('musicEnabled') !== null) {
                gameState.musicEnabled = localStorage.getItem('musicEnabled') === 'true';
            }
            
            if (localStorage.getItem('soundEffectsEnabled') !== null) {
                gameState.soundEffectsEnabled = localStorage.getItem('soundEffectsEnabled') === 'true';
            }
            
            if (localStorage.getItem('hardMode') !== null) {
                gameState.hardMode = localStorage.getItem('hardMode') === 'true';
            }
            
            if (localStorage.getItem('gamesPlayed')) {
                gameState.gamesPlayed = parseInt(localStorage.getItem('gamesPlayed'));
            }
            
            if (localStorage.getItem('gamesWon')) {
                gameState.gamesWon = parseInt(localStorage.getItem('gamesWon'));
            }
            
            if (localStorage.getItem('winStreak')) {
                gameState.winStreak = parseInt(localStorage.getItem('winStreak'));
            }
            
            updateDifficultyIndicator();
            
            elements.playerNameInput.value = gameState.playerName;
            elements.musicToggle.checked = gameState.musicEnabled;
            elements.soundEffectsToggle.checked = gameState.soundEffectsEnabled;
            elements.hardModeToggle.checked = gameState.hardMode;
            
            if (gameState.musicEnabled) {
                elements.bgMusic.volume = 0.3;
            }
            
            elements.winSound.volume = 0.5;
            elements.loseSound.volume = 0.5;
            elements.clickSound.volume = 0.3;

            // Set initial API status
            elements.apiStatus.classList.add('connected');
            elements.apiStatus.querySelector('span').textContent = 'Mode Online';
        }

        function generateSecretNumber() {
            const maxNumber = gameState.hardMode ? 200 : 100;
            gameState.secretNumber = Math.floor(Math.random() * maxNumber) + 1;
            gameState.attempts = 0;
            elements.attemptsDisplay.textContent = gameState.attempts;
            gameState.gameActive = true;
            elements.guessBtn.disabled = false;
            console.log("Angka rahasia:", gameState.secretNumber);
        }

        function checkGuess() {
            if (!gameState.gameActive) return;
            
            playSound('click');
            
            const userGuess = parseInt(elements.guessInput.value);
            const maxNumber = gameState.hardMode ? 200 : 100;
            
            if (isNaN(userGuess)) {
                const msg = "Masukkan angka yang valid!";
                showMessage(msg);
                speak(msg);
                shakeInput();
                playSound('lose');
                return;
            }
            
            if (userGuess < 1 || userGuess > maxNumber) {
                const msg = `Angka harus antara 1-${maxNumber}!`;
                showMessage(msg);
                speak(msg);
                shakeInput();
                playSound('lose');
                return;
            }
            
            gameState.attempts++;
            gameState.lastGuess = userGuess;
            elements.attemptsDisplay.textContent = gameState.attempts;
            elements.lastGuessDisplay.textContent = userGuess;
            
            if (userGuess === gameState.secretNumber) {
                handleWin();
            } else if (userGuess < gameState.secretNumber) {
                handleGuessTooLow(userGuess);
            } else {
                handleGuessTooHigh(userGuess);
            }
            
            elements.guessInput.value = '';
            elements.guessInput.focus();
        }

        function handleWin() {
            gameState.gamesPlayed++;
            gameState.gamesWon++;
            gameState.winStreak++;
            localStorage.setItem('gamesPlayed', gameState.gamesPlayed);
            localStorage.setItem('gamesWon', gameState.gamesWon);
            localStorage.setItem('winStreak', gameState.winStreak);
            
            const winMessage = `üéâ <b>Tebakanmu benar ${gameState.playerName}!</b><br>Angkanya adalah ${gameState.secretNumber}.<br>Kamu menebak dalam ${gameState.attempts} percobaan.`;
            showMessage(winMessage);
            
            const aiWinMsg = getRandomResponse('win');
            speak(aiWinMsg);
            
            gameState.gameActive = false;
            elements.guessBtn.disabled = true;
            animateAI('happy');
            playSound('win');
            createConfetti();
            updateStatsDisplay();
            
            if (gameState.bestScore === null || gameState.attempts < gameState.bestScore) {
                const now = new Date();
                gameState.bestScore = gameState.attempts;
                gameState.bestScoreDate = now.toISOString();
                gameState.bestScorePlayer = gameState.playerName;
                
                localStorage.setItem('bestScore', gameState.attempts);
                localStorage.setItem('bestScoreDate', now.toISOString());
                localStorage.setItem('bestScorePlayer', gameState.playerName);
                
                elements.bestScoreDisplay.textContent = gameState.bestScore;
                
                showMessage(`${winMessage}<br><br><b>üéä REKOR BARU!</b>`);
                speak("Wah, ini rekor terbaru! Hebat sekali!");
                
                setTimeout(() => {
                    createConfetti();
                    playSound('win');
                }, 1000);
            }
            
            if (gameState.winStreak >= 3 && !gameState.hardMode) {
                showMessage(`${winMessage}<br><br><i>Kamu telah memenangkan ${gameState.winStreak} game berturut-turut! Mode Sulit akan diaktifkan untuk game berikutnya.</i>`);
                speak(`Kamu telah memenangkan ${gameState.winStreak} game berturut-turut! Aku akan membuat game berikutnya lebih menantang.`);
                
                gameState.hardMode = true;
                localStorage.setItem('hardMode', 'true');
                updateDifficultyIndicator();
            }
        }

        function handleGuessTooLow(guess) {
            const msg = `${guess} terlalu <b>RENDAH</b>. Coba lagi!`;
            showMessage(msg);
            
            const lowMsg = getRandomResponse('tooLow');
            speak(lowMsg);
            
            playSound('lose');
        }

        function handleGuessTooHigh(guess) {
            const msg = `${guess} terlalu <b>TINGGI</b>. Coba lagi!`;
            showMessage(msg);
            
            const highMsg = getRandomResponse('tooHigh');
            speak(highMsg);
            
            playSound('lose');
        }

        async function giveHint() {
            if (!gameState.gameActive) return;
            
            playSound('click');
            showTyping(true);
            animateAI('thinking');
            
            try {
                let hint;
                
                const prompt = `Berikan petunjuk kreatif untuk angka rahasia ${gameState.secretNumber} (range 1-${gameState.hardMode ? 200 : 100}) tanpa mengungkapkan angka langsung. Pemain sudah menebak ${gameState.attempts} kali.`;
                hint = await queryGemini(prompt);
                hint = `<b>Petunjuk Cici:</b> ${hint}`;
                
                showMessage(hint);
                speak(hint);
            } catch (error) {
                const localHint = getRandomResponse('hint');
                showMessage(`<b>Petunjuk Cici:</b> ${localHint}`);
                speak(localHint);
            } finally {
                showTyping(false);
            }
        }

        function startNewGame() {
            playSound('click');
            generateSecretNumber();
            
            const maxNumber = gameState.hardMode ? 200 : 100;
            const newGameMsg = getRandomResponse('greetings');
            
            showMessage(newGameMsg);
            speak(newGameMsg);
            elements.guessInput.value = '';
            elements.guessInput.focus();
            elements.lastGuessDisplay.textContent = '-';
            
            console.log("Angka rahasia baru:", gameState.secretNumber);
        }

        function toggleSettingsPanel() {
            playSound('click');
            elements.settingsPanel.classList.toggle('open');
            elements.settingsOverlay.classList.toggle('open');
            
            if (elements.settingsPanel.classList.contains('open')) {
                elements.playerNameInput.value = gameState.playerName;
                elements.musicToggle.checked = gameState.musicEnabled;
                elements.soundEffectsToggle.checked = gameState.soundEffectsEnabled;
                elements.hardModeToggle.checked = gameState.hardMode;
            }
        }

        function saveSettings() {
            playSound('click');
            
            const newName = elements.playerNameInput.value.trim() || "Player";
            const musicEnabled = elements.musicToggle.checked;
            const soundEffectsEnabled = elements.soundEffectsToggle.checked;
            const hardMode = elements.hardModeToggle.checked;
            
            gameState.playerName = newName;
            gameState.musicEnabled = musicEnabled;
            gameState.soundEffectsEnabled = soundEffectsEnabled;
            gameState.hardMode = hardMode;
            
            localStorage.setItem('playerName', newName);
            localStorage.setItem('musicEnabled', musicEnabled);
            localStorage.setItem('soundEffectsEnabled', soundEffectsEnabled);
            localStorage.setItem('hardMode', hardMode);
            
            if (musicEnabled) {
                elements.bgMusic.play().catch(e => console.log("Audio play blocked:", e));
            } else {
                elements.bgMusic.pause();
            }
            
            updateDifficultyIndicator();
            toggleSettingsPanel();
            showSpeechBubble("Pengaturan disimpan!", 2000);
        }

        function updateDifficultyIndicator() {
            if (gameState.hardMode) {
                elements.difficultyIndicator.textContent = "Sulit";
                elements.difficultyIndicator.style.color = "#e74c3c";
            } else {
                elements.difficultyIndicator.textContent = "Normal";
                elements.difficultyIndicator.style.color = "#3498db";
            }
        }

        function toggleAssistantPanel() {
            playSound('click');
            elements.assistantPanel.classList.toggle('open');
            if (elements.assistantPanel.classList.contains('open')) {
                elements.assistantInput.focus();
            }
        }

        function addAssistantMessage(message, sender) {
            const messageDiv = document.createElement('div');
            messageDiv.className = `assistant-message ${sender}-message`;
            messageDiv.textContent = message;
            elements.assistantMessages.appendChild(messageDiv);
            elements.assistantMessages.scrollTop = elements.assistantMessages.scrollHeight;
        }

        async function sendAssistantMessage() {
            const message = elements.assistantInput.value.trim();
            if (!message) return;
            
            playSound('click');
            addAssistantMessage(message, 'user');
            elements.assistantInput.value = '';
            
            showTyping(true);
            
            try {
                const response = await queryGemini(message);
                addAssistantMessage(response, 'bot');
                speak(response);
            } catch (error) {
                const fallbackResponse = getRandomResponse('assistant');
                addAssistantMessage(fallbackResponse, 'bot');
                speak(fallbackResponse);
            } finally {
                showTyping(false);
            }
        }

        function showMessage(msg) {
            showTyping(false);
            
            elements.messageArea.innerHTML = `<p>${msg}</p>`;
            elements.messageArea.scrollTop = elements.messageArea.scrollHeight;
        }

        function showTyping(show) {
            elements.typingIndicator.style.display = show ? 'flex' : 'none';
            if (show) {
                elements.messageArea.innerHTML = '<p>Cici sedang berpikir...</p>';
            }
        }

        function shakeInput() {
            elements.guessInput.classList.add('animate__animated', 'animate__shakeX');
            setTimeout(() => {
                elements.guessInput.classList.remove('animate__animated', 'animate__shakeX');
            }, 1000);
        }

        function animateAI(action) {
            const character = elements.aiCharacter.querySelector('svg');
            
            switch(action) {
                case 'happy':
                    character.classList.add('happy');
                    setTimeout(() => character.classList.remove('happy'), 1000);
                    break;
                    
                case 'thinking':
                    character.classList.add('thinking');
                    animateEyes();
                    setTimeout(() => character.classList.remove('thinking'), 3000);
                    break;
            }
        }

        function animateEyes() {
            const leftPupil = elements.aiCharacter.querySelector('circle:nth-of-type(3)');
            const rightPupil = elements.aiCharacter.querySelector('circle:nth-of-type(4)');
            
            const animate = () => {
                const x1 = 70 + (Math.random() * 10 - 5);
                const y1 = 75 + (Math.random() * 5 - 2.5);
                const x2 = 130 + (Math.random() * 10 - 5);
                const y2 = 75 + (Math.random() * 5 - 2.5);
                
                leftPupil.setAttribute('cx', x1);
                leftPupil.setAttribute('cy', y1);
                rightPupil.setAttribute('cx', x2);
                rightPupil.setAttribute('cy', y2);
            };
            
            const eyeInterval = setInterval(animate, 800);
            setTimeout(() => {
                clearInterval(eyeInterval);
                leftPupil.setAttribute('cx', '70');
                leftPupil.setAttribute('cy', '80');
                rightPupil.setAttribute('cx', '130');
                rightPupil.setAttribute('cy', '80');
            }, 3000);
        }

        function showSpeechBubble(text, duration = 3000) {
            elements.speechBubble.textContent = text;
            elements.speechBubble.classList.add('show');
            
            setTimeout(() => {
                elements.speechBubble.classList.remove('show');
            }, duration);
        }

        function playSound(type) {
            if (!gameState.soundEffectsEnabled) return;
            
            try {
                switch(type) {
                    case 'win':
                        elements.winSound.currentTime = 0;
                        elements.winSound.play().catch(e => console.log("Win sound play blocked:", e));
                        break;
                    case 'lose':
                        elements.loseSound.currentTime = 0;
                        elements.loseSound.play().catch(e => console.log("Lose sound play blocked:", e));
                        break;
                    case 'click':
                        elements.clickSound.currentTime = 0;
                        elements.clickSound.play().catch(e => console.log("Click sound play blocked:", e));
                        break;
                }
            } catch (e) {
                console.log("Error playing sound:", e);
            }
        }

        function createConfetti() {
            elements.confettiContainer.innerHTML = '';
            
            for (let i = 0; i < 50; i++) {
                const confetti = document.createElement('div');
                confetti.style.position = 'absolute';
                confetti.style.width = '10px';
                confetti.style.height = '10px';
                confetti.style.backgroundColor = getRandomColor();
                confetti.style.borderRadius = '50%';
                confetti.style.left = `${Math.random() * 100}%`;
                confetti.style.top = '-10px';
                confetti.style.animation = `confetti ${Math.random() * 3 + 2}s linear forwards`;
                confetti.style.animationDelay = `${Math.random() * 0.5}s`;
                confetti.style.transform = `rotate(${Math.random() * 360}deg)`;
                
                elements.confettiContainer.appendChild(confetti);
            }
        }

        function getRandomColor() {
            const colors = [
                '#3498db', '#e74c3c', '#2ecc71', '#f39c12', 
                '#9b59b6', '#1abc9c', '#d35400', '#34495e'
            ];
            return colors[Math.floor(Math.random() * colors.length)];
        }

        function loadVoices() {
            voices = synth.getVoices();
        }

        function speak(text) {
            if (gameState.aiSpeaking || !synth) return;
            
            gameState.aiSpeaking = true;
            showSpeechBubble(text);
            elements.mouthAnimated.style.display = 'block';
            elements.mouth.style.display = 'none';
            
            const utterance = new SpeechSynthesisUtterance(text);
            
            const indonesianVoice = voices.find(v => v.lang.includes('id-ID') && v.name.includes('Female'));
            const englishVoice = voices.find(v => v.lang.includes('en') && v.name.includes('Female'));
            utterance.voice = indonesianVoice || englishVoice || voices[0];
            
            utterance.rate = 0.9;
            utterance.pitch = 1.2;
            utterance.volume = 1;
            
            utterance.onstart = function() {
                elements.mouthAnimated.style.display = 'block';
                elements.mouth.style.display = 'none';
            };
            
            utterance.onend = function() {
                gameState.aiSpeaking = false;
                elements.mouthAnimated.style.display = 'none';
                elements.mouth.style.display = '';
            };
            
            synth.speak(utterance);
        }

        function updateUIMode() {
            elements.aiCharacter.style.filter = "grayscale(50%)";
        }

        function updateStatsDisplay() {
            elements.totalGamesDisplay.textContent = gameState.gamesPlayed;
            elements.gamesWonDisplay.textContent = gameState.gamesWon;
            elements.currentStreakDisplay.textContent = gameState.winStreak;
            
            if (gameState.bestScore !== null) {
                elements.bestAttemptDisplay.textContent = gameState.bestScore;
            }
            
            if (gameState.gamesPlayed > 0) {
                const winRate = Math.round((gameState.gamesWon / gameState.gamesPlayed) * 100);
                elements.winRateDisplay.textContent = `${winRate}%`;
            }
        }

        function switchTab(tabName) {
            playSound('click');
            
            document.querySelectorAll('.main-content').forEach(section => {
                section.classList.remove('active');
            });
            
            document.querySelectorAll('.nav-btn').forEach(btn => {
                btn.classList.remove('active');
            });
            
            document.getElementById(`${tabName}-section`).classList.add('active');
            document.getElementById(`${tabName}-btn`).classList.add('active');
            
            if (tabName === 'stats') {
                updateStatsDisplay();
            }
        }
    </script>
</body>
</html>
